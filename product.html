<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- TikTok Pixel Code Start -->
<script>
!function (w, d, t) {
  w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};


  ttq.load('D4H50F3C77UA1JCPR9L0');
  ttq.page();
}(window, document, 'ttq');
</script>
<!-- TikTok Pixel Code End -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    
    <style>
        :root { --primary: #FF5000; --bg: #eff0f5; --white: #fff; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; }
        
        /* Image Header */
        .product-header { position: relative; background: var(--white); }
        .main-img { width: 100%; height: 350px; object-fit: cover; }
        .back-icon { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.3); color: white; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }

        /* Info Section */
        .info-box { background: var(--white); padding: 15px; margin-bottom: 10px; }
        .price-lg { color: var(--primary); font-size: 1.6rem; font-weight: 800; }
        .title-lg { font-size: 1.1rem; margin: 10px 0; color: #333; line-height: 1.5; }
        .stock-badge { background: #e6f7ff; color: #1890ff; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; }

        /* Actions Bar */
        .action-bar { position: fixed; bottom: 0; width: 100%; background: var(--white); display: flex; padding: 10px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 100; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 25px; color: white; font-weight: 700; font-size: 1rem; cursor: pointer; margin: 0 5px; }
        .btn-cart { background: #ff9900; }
        .btn-buy { background: #FF5000; }
        .icon-btn { width: 50px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.7rem; color: #666; cursor: pointer; }
        .icon-btn i { font-size: 1.2rem; margin-bottom: 2px; }
    </style>
</head>
<body>

    <div class="product-header">
        <div class="back-icon" onclick="history.back()"><i class="fa-solid fa-arrow-right"></i></div>
        <img id="p-img" src="" class="main-img">
    </div>

    <div class="info-box">
        <div class="price-lg" id="p-price">...</div>
        <h1 class="title-lg" id="p-name">...</h1>
        <span class="stock-badge" id="p-stock">Ù…ØªÙˆÙØ±</span>
    </div>

    <div class="info-box">
        <h3 style="font-size:1rem; margin-bottom:10px;">Ø§Ù„ÙˆØµÙ</h3>
        <p id="p-desc" style="color:#666; line-height:1.6; font-size:0.95rem; white-space: pre-wrap;">...</p>
    </div>

    <div class="action-bar">
        <div class="icon-btn" onclick="window.location.href='index.html'">
            <i class="fa-solid fa-store"></i> Ø§Ù„Ù…ØªØ¬Ø±
        </div>
        <button class="btn btn-cart" onclick="addToCart(false)">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
        <button class="btn btn-buy" onclick="addToCart(true)">Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†</button>
    </div>

    <script>
        const SUPABASE_URL = 'https://pajxormplmloivyankji.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBhanhvcm1wbG1sb2l2eWFua2ppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0ODQ3OTksImV4cCI6MjA3NjA2MDc5OX0.eEPB_Gt5HywU9oGNXLpSNc4IA7CTTL7CX-EMKDE3yec';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        let currentProduct = null;

        async function loadProduct() {
            if(!id) return;
            const { data, error } = await supabase.from('products').select('*').eq('id', id).single();
            
            if(data) {
                currentProduct = data;
                let img = data.image_url ? (Array.isArray(data.image_url) ? data.image_url[0] : data.image_url.split(',')[0]) : 'https://via.placeholder.com/300';
                
                document.getElementById('p-img').src = img;
                document.getElementById('p-name').innerText = data.name;
                document.getElementById('p-price').innerText = Number(data.price).toLocaleString() + ' Ø¯.Ø¹';
                document.getElementById('p-desc').innerText = data.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ';
                document.getElementById('p-stock').innerText = data.stock > 0 ? `Ù…ØªÙˆÙØ±: ${data.stock}` : 'Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ©';
                ttq.track('ViewContent', {
	"contents": [
		{
			"content_id": "<content_identifier>", // string. ID of the product. Example: "1077218".
			"content_type": "<content_type>", // string. Either product or product_group.
			"content_name": "<content_name>" // string. The name of the page or product. Example: "shirt".
		}
	],
	"value": "<content_value>", // number. Value of the order or items sold. Example: 100.
	"currency": "<content_currency>" // string. The 4217 currency code. Example: "USD".
}, {
	"event_id": "<event_id>" // string. A hashed ID that can identify a unique event. Example: "1616318632825_357".
});
            }
        }

        function addToCart(redirect) {
            if(!currentProduct) return;
            
            let cart = JSON.parse(localStorage.getItem('velin_cart')) || [];
            cart.push({
                product_id: currentProduct.id,
                name: currentProduct.name,
                price: Number(currentProduct.price),
                temp_id: Date.now()
            });
            localStorage.setItem('velin_cart', JSON.stringify(cart));

			// ğŸ”¥ TikTok Pixel: ØªÙØ¹ÙŠÙ„ Ø­Ø¯Ø« Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© (AddToCart)
            if (window.ttq) {
                ttq.track('AddToCart', {
                    contents: [{
                        content_id: currentProduct.id.toString(),
                        content_type: 'product',
                        content_name: currentProduct.name
                    }],
                    value: Number(currentProduct.price),
                    currency: 'IQD'
                });

                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø²Ø± Ù‡Ùˆ "Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†"ØŒ Ù†Ø±Ø³Ù„ Ø­Ø¯Ø« Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙØ¹ Ø£ÙŠØ¶Ø§Ù‹ (InitiateCheckout)
                if(redirect) {
                    ttq.track('InitiateCheckout', {
                        contents: [{
                            content_id: currentProduct.id.toString(),
                            content_type: 'product',
                            content_name: currentProduct.name
                        }],
                        value: Number(currentProduct.price),
                        currency: 'IQD'
                    });
                }
            }
            
            if(redirect) {
                // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆØ¬ÙŠÙ‡Ù‡ Ù„ØµÙØ­Ø© "Ø§Ù„Ø¯ÙØ¹" Checkout (ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
                // Ø­Ø§Ù„ÙŠØ§Ù‹ Ø³Ù†Ø±Ø¬Ø¹Ù‡ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø­ÙŠØ« ØªÙˆØ¬Ø¯ Ø§Ù„Ø³Ù„Ø©
                alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©ØŒ Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø³Ù„Ø© Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨');
                window.location.href = 'index.html'; 
            } else {
                alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©');
            }
        }

        loadProduct();
    </script>
</body>

</html>




